
## 为什么使用多进程架构？

使用多个进程来保护整个应用程序免受渲染引擎或其他组件中的错误和故障影响。他还可以限制每个渲染引擎进程对其他进程和系统其余部分的访问。

总结一下：
- 多进程架构相比但进程架构更加稳定，单进程架构一旦出错将会导致整个应用程序的崩溃。多进程架构则更加健壮，某个进程出错不会影响其他进程正常运行。
- 安全性，操作系统可以提供沙盒来限制进程的权限，可以将某些进程按照其功能沙盒化，限制其权限。这样更加安全。

> Chorme 会根据当前硬件的配置来动态调整其架构以确保功能与性能。

## 都有哪些主要进程

浏览器中主要有下面几个主要进程：

- 主进程：浏览器主进程负责管理整个浏览器的 UI（地址栏、前进、退回按钮等），进行网络通信等
- 渲染进程：每个 Tab 单独拥有一个渲染进程，负责网页的布局、渲染。（网页的网络请求是委托主进程去请求）
- 插件进程：负责网站的插件
- GPU 进程：负责调用 GPU 的相关功能

### 主进程

所有的网络请求都是主进程进行处理，各个渲染进程需要委托主进程来处理网络请求。这也涉及到进程之间的通信。

**这样做不仅是为了使浏览器进程能够控制每个渲染器对网络的访问，也是为了让我们能够在各个进程之间保持一致的会话状态（如 cookie 和缓存数据）。**

### 渲染进程

渲染进程负责再标签页中发生的一切。在渲染器进程中，主线程会处理你发给用户的大部分代码。如果使用了 Web Worker 或 Service Worker，则有是 JS 的部分内容有工作器线程处理。合成器小县城和光栅线程也在渲染器进程内运行。

渲染进程的核心任务是将 HTML、CSS、JS 转换为用户可以与之交互的网页。

#### DOM 构建

渲染程序接收到 HTML 数据时，**主线程**开始解析 HTML 字符串，构建 DOM 树。

#### 子资源加载

**主线程**在解析 HTML 的过程中可以能发现 CSS、JS、图片等外部资源，这些文件需要从网络或者缓存加载。

**主线程**在解析 HTML 时可以找到它们并逐个请求，但为了加快速度，会并发运行“预加载扫描器”。如果 HTML 文档中有 `<img>` 或 `<link>` 之类的内容，预加载扫描程序会查看 HTML 解析器生成的令牌，并将请求发送到浏览器进程中的网络线程。

#### 样式计算

拥有 DOM 并不足以知道页面的显示效果，因为我们可以在 CSS 中设置页面元素的样式。**主线程**解析 CSS 并确定每个 DOM 节点的计算样式。这是关于根据 CSS 选择器将哪种样式应用于每个元素的信息。您可以在开发者工具的 `computed` 部分查看此信息。

#### 布局

布局是查找元素几何图形的过程。**主线程**会遍历 DOM 和计算出的样式，并创建布局树，其中包含 x y 坐标和边界框大小等信息。布局树的结构可能与 DOM 树类似，但它仅包含与页面上可见内容相关的信息。如果应用了 `display: none`，则该元素不属于布局树（然而，具有 `visibility: hidden` 的元素在布局树中）。同样，如果应用包含类似 `p::before{content:"Hi!"}` 的伪元素，它就会包含在布局树中，即使它不在 DOM 中也是如此。

#### 合成

合成是一种技术，可将网页的各个部分分离成图层，分别将它们光栅化，然后在单独的线程（称为“合成器线程”）中合成为网页。如果发生滚动，由于图层已光栅化，因此只需合成新帧即可。同样，可以通过移动层和合成新帧来实现动画效果。

## 进程之间的通信

多进程之间使用 IPC 命名管道进行通信
## 参考

[深入了解现代网络浏览器（第 1 部分）  |  Blog  |  Chrome for Developers](https://developer.chrome.com/blog/inside-browser-part1?hl=zh_cn#execute_program_on_process_and_thread)
[深入了解现代网络浏览器（第 3 部分）  |  Blog  |  Chrome for Developers](https://developer.chrome.com/blog/inside-browser-part3?hl=zh-cn)
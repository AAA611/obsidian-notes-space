
## HTTP/1.1 持久连接

HTTP/1.1 指的是 `Connection: keep-alive` 头部

HTTP/1.1 的持久连接**默认情况下是激活**的，除非特别指明。

要在事务处理结果之后将连接关闭，必须显式向报文中添加一个 `Connection: close` 头部。

**HTTP/1.1 客户端在收到响应之后仍然保持连接的打开状态**，除非收到一个 `Connection: close` 头部。但请注意，没有收到 `Connection：close` 也并不代表连接会一直打开，这由浏览器或者服务器具体实现决定，假如一个连接在打开很久依然没有任何请求可能就会被关闭，这样避免浪费双方资源。

## 管道化连接

HTTP/1.1 允许在持久连接上可选地使用 `请求管道` 。这是相对于 `keep-alive` 连接的又一性能优化。

在响应到达之前，可以将多条请求放入队列。

当第一条请求发送后，第二条、第三条请求也可以开始发送了。在高延时网络条件下，这样做可以降低网络的环回时间，提高性能。简单来说，没有管道化连接的情况下，请求二必须等待请求一的响应到达客户端，客户端才可以发送请求二。
有管道化连接的情况下，请求已发送之后就可以发送请求二，请求二的发送不需要等待请求一的响应返回，但是由于请求一与请求二是同一个 TCP 连接，所以请求二的处理需要等待服务器先把请求一处理完。这也就是 **HTTP/1.1 队头阻塞**。

**持久连接：**

![[image-20240808164806987.png]]

**管道话持久连接：**

![[image-20240808165112096.png]]

**可以看到，管道话的区别在于请求一还未响应完成，请求二的请求报文旧可以先发送出去了，这有效利用了等待请求一响应的这段空闲时间。**




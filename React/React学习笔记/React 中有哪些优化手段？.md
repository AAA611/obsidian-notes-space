
## 为什么需要优化 React

react 的每次的更新过程是从根节点开始遍历，然后确定需要更新的组件。一般来说，一个组件在发生下面几种情况时会发生更新：

- state 变化
- props 变化
- 依赖的 context 变化

一个组件如果出现上面情况的一个或多个，都会触发组件的更新。在 react 中，一个组件的更新就需要重新执行组件的渲染函数（ class 组件中 render 函数，Function 组件的本身 ）返回新的 JSX。默认情况下，父组件执行了渲染函数，子组件也要执行渲染函数，这是因为父组件执行了渲染函数之后返回了新的 JSX，在构建新的 fiberTree 时，新的 JSX 与老的 fiber 中的 props 一定是不相同的对象，所以 react 无法直接复用子组件对应的 fiberNode，只能重新调用子组件获得 JSX 对象来重新构建 fiberNode。

## 怎么优化

优化的目的是让 react 尽可能的复用子组件的 fiberNode, 而不是重新执行子组件渲染函数来重新构建

## 如何优化 React

此处指的更新是指 React 在经过了第一次的挂载之后，后续再进行的更新流程。

- **发起更新**
	- React 中的更新首先要触发更新，常见的触发方式有 useState 中的 setXXX 方法，Context 变化
	- 发起更新后 React 会调度一个更新任务，这个任务从 React 的根节点开始进行
- **调和阶段**
	- React 从根节点开始遍历整个 Fiber 树，逐个确定哪些需要更新，哪些不需要更新
	- 符合下面所有情况的，则不会发生更新：
		- `newProps===oldProps` 注意是全等
		- 旧的 context 没有发生变化
		- fiberNode. type 没有发生变化
		- 组件本身没有发生更新
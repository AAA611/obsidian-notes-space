## 简介

跨站脚本攻击，英文全程是 Cross Site Script。本来是缩写为 CSS，但是为了与 （Cascading Style Sheet，CSS）做区分，所以在安全领域叫做 XSS。

XSS 攻击，通常指黑客通过 "HTML 注入" <mark style="background: #BBFABBA6;">篡改了网页，插入了恶意脚本</mark>，从而在用户浏览网页时，控制用户浏览器的一种攻击。

## XSS 的分类

XSS 主要分为三类，分别是：
- 反射型 XSS
- 存储型 XSS
- DOM Based XSS

### 反射型 XSS

反射型 XSS 只是简单地把用户输入的数据 "反射" 给浏览器。反射型 XSS 也叫 "非持久型 XSS"。

### 存储型 XSS

存储型 XSS 会把用户输入的数据 "存储" 在服务器端。这种 XSS 具有很强的稳定性。

例如：黑客写下一篇包含恶意 JavaScript 代码的博客文章，文章发表后被储存在服务器端，所有访问该博客文章的用户，都会在他们的浏览器中执行这段恶意的 JavaScript 代码。这种 XSS 攻击就叫做 “存储型 XSS”。

存储型 XSS 也叫做持久型 XSS。

### DOM Based XSS

这是一种通过修改页面的 DOM 节点形成的 XSS，所以称之为 DOM Based XSS。

## XSS 常见攻击

### Cookie 劫持

通过往客户端注入恶意脚本，通过恶意脚本读取用户的 Cookie 信息，可以发起 "Cookie" 劫持攻击。攻击者主要利用了 JavaScript 可以读取 Cookie 的特点发起攻击。

攻击者可以通过注入恶意脚本 a.js, 然后在 a.js 中读取 Cookie，并且可以通过发起请求把 Cookie 发送到远端的恶意服务器。

### 构造恶意请求

通过分析要攻击的网站的某个接口，然后注入恶意脚本，在恶意脚本中构造特定的请求，然后发起请求从而达到攻击的目的。

## XSS 的防御

### HttpOnly

支持了 HttpOnly 的浏览器会禁止 JavaScript 访问带有 HttpOnly 属性的 Cookie。

HttpOnly 能有效缓解 XSS 攻击中的 Cookie 劫持问题，但仍然需要其他能够解决 XSS 的方案。

### 输入检查

常见的 Web 漏洞如 XSS，SQL 注入等，都要求攻击者构造一些特殊字符，这些特殊字符可能是正常用户不会用到的，所以输入检查就有存在的必要了。

在 XSS 防御上，输入检查一般检查用户输入是否包含一些特殊字符，如 `<、> ` 等。如发现，则将这些字符进行过滤或者编码。这种输入检查的方式可以称之为 XSS Filter。

### 输出检查

任何用户的输入都是 “不可信任的”，在将其显示到页面上之前，最好对其进行输出检查。

在把用户输入输出到 HTML 页面上时，可以使用编码或转义的方式来防御 XSS 攻击。

根据需要可以选择严格禁止某些危险标签如 `<script> <iframe> <form>` 等。


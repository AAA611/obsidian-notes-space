
## 什么是分包？

分包指的是对 webpack 打包的产物以某种方式进行分割，将一个或多个庞大的产物分割成更细粒度的多个产物。

## 为什么需要分包？

如果全部打包到一个文件中的话，则可能存在以下问题：

- 单个文件的体积会很大，这在客户端请求的时候，网络传输上可能会比较耗时，无法更好地利用浏览器的并发请求能力（TODO：自己实验一下）。
- 不利于浏览器缓存，如果应用有更新，则浏览器需要重新请求一个很大的更新的文件，实际上我们可能只改了一点点代码，造成了带宽浪费与性能体验的下降。
- 无法按需加载，一些可能当前不需要的代码也会一并被加载，这会导致渲染时长变长。不利于首屏，降低用户体验。
## webpack 中有哪些分包方式？

一般来说，webpack 会根据下面的情况进行分包：

- Entry 入口
	- 每个 Entry 对应一个 chunk，通常会有单独的产物
- import（）动态导入
	- 使用 `import()` 动态导入的代码会被抽离为一个单独的 chunk，这便于后续的按需加载
- splitChunks
	- webpack V5 中内置了 `optimization.splitChunks` 功能来允许开发者更加精细地配置 webpack 分包
	- splitChunks 有一系列的默认值（ 这是 webpack 总结出来的最佳实践，在大多数情况下，我们只需要使用默认配置就好，永远不要做过早的优化，当我们真的觉得默认配置适应不了我们现在的场景的时候（ 这通常需要有数据支持 ），在考虑自定义配置 splitChunks ）

## 分包的好处

通过分包，我们将产物细粒度地差分为多个文件，这样做有以下好处：

- 这样浏览器就可以同时请求多个小文件而不是请求一个大文件。利用浏览器并发请求的能力。
- 更好地利用浏览器缓存，应用更新时可能只影响了某一个最终产物，那么浏览器只需要请求这个更新的文件即可，其他文件还可以继续使用缓存。
- 按需加载，按需加载是一个很常见且有效的优化手段，通过分包我们可以先加载当前页面必须的文件，在使用过程中按需加载其他文件，这在没有分包之前是无法做到的。

## 分包的策略有哪些？

### 经常变化的与不经常变化的分离开

通常情况下项目的依赖不会经常变化，我们可以将其抽离为单独的包（ 使用 splitChunks 实现 ）

一些业务代码经常变化也抽离成单独的包，这样应用更新时，浏览器只需要重新请求这个变化的文件就可以了

### 根据路由拆分包

根据路由拆分包可以实现按需加载，通常使用 `import()` 动态导入来实现。